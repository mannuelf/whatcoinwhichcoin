'use strict';

var path = require('path');

var loaderUtils = require('loader-utils');

var defaultOptions = {
    fileMap: '{fileName}'
};

module.exports = function (content) {
    this.cacheable();
    var options = Object.assign({}, defaultOptions, loaderUtils.getOptions(this));

    var accept = options.cssModules ? '' : 'module.hot.accept(undefined, cssReload);';
    return content + '\n    if(module.hot) {\n      // ' + Date.now() + '\n      var cssReload = require(' + loaderUtils.stringifyRequest(this, path.join(__dirname, 'hotModuleReplacement.js')) + ')(module.id, ' + JSON.stringify(options) + ');\n      module.hot.dispose(cssReload);\n      ' + accept + ';\n    }\n  ';
};